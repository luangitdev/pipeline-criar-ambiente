16:16:51  Started by user infraestrutura
16:16:51  Obtained Jenkinsfile from git https://github.com/luangitdev/pipeline-criar-ambiente.git
16:16:52  [Pipeline] Start of Pipeline
16:16:52  [Pipeline] node
16:16:52  Running on Jenkins in /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE
16:16:52  [Pipeline] {
16:16:52  [Pipeline] stage
16:16:52  [Pipeline] { (Declarative: Checkout SCM)
16:16:52  [Pipeline] checkout
16:16:52  Selected Git installation does not exist. Using Default
16:16:52  The recommended git tool is: NONE
16:16:52  using credential github-credentials-luan
16:16:52   > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/.git # timeout=10
16:16:52  Fetching changes from the remote Git repository
16:16:52   > git config remote.origin.url https://github.com/luangitdev/pipeline-criar-ambiente.git # timeout=10
16:16:52  Fetching upstream changes from https://github.com/luangitdev/pipeline-criar-ambiente.git
16:16:52   > git --version # timeout=10
16:16:52   > git --version # 'git version 2.39.5'
16:16:52  using GIT_ASKPASS to set credentials Credenciais da conta github (Luan)
16:16:52   > git fetch --tags --force --progress -- https://github.com/luangitdev/pipeline-criar-ambiente.git +refs/heads/*:refs/remotes/origin/* # timeout=10
16:16:52   > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
16:16:52  Checking out Revision 4558386b24bc15f9209630f9cbd1b5ca04e6238b (refs/remotes/origin/main)
16:16:52   > git config core.sparsecheckout # timeout=10
16:16:52   > git checkout -f 4558386b24bc15f9209630f9cbd1b5ca04e6238b # timeout=10
16:16:52  Commit message: "debug: Adiciona verifica√ß√£o detalhada das credenciais Jenkins"
16:16:52   > git rev-list --no-walk 6caa363c36311af0d990adc51ee239d89266f825 # timeout=10
16:16:52  [Pipeline] }
16:16:52  [Pipeline] // stage
16:16:53  [Pipeline] withEnv
16:16:53  [Pipeline] {
16:16:53  [Pipeline] withEnv
16:16:53  [Pipeline] {
16:16:53  [Pipeline] stage
16:16:53  [Pipeline] { (üîç Valida√ß√£o de Par√¢metros)
16:16:53  [Pipeline] script
16:16:53  [Pipeline] {
16:16:53  [Pipeline] echo
16:16:53  üöÄ ===== PIPELINE CRIAR AMBIENTE =====
16:16:53  [Pipeline] echo
16:16:53  üìã Par√¢metros recebidos:
16:16:53  [Pipeline] echo
16:16:53     - Tipo Ambiente: ptf
16:16:53  [Pipeline] echo
16:16:53     - Servidor: gcp01
16:16:53  [Pipeline] echo
16:16:53     - Nome Banco: ptf_base_teste
16:16:53  [Pipeline] echo
16:16:53     - Vers√£o: 15.13.1.0-1
16:16:53  [Pipeline] echo
16:16:53     - Criar Banco: true
16:16:53  [Pipeline] echo
16:16:53     - Deploy App: false
16:16:53  [Pipeline] echo
16:16:53  =======================================
16:16:53  [Pipeline] sh
16:16:53  + /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/get_db_host.sh gcp01
16:16:53  [Pipeline] echo
16:16:53  ‚úÖ Valida√ß√£o conclu√≠da. DB Host: 10.200.0.19
16:16:53  [Pipeline] }
16:16:53  [Pipeline] // script
16:16:53  [Pipeline] }
16:16:53  [Pipeline] // stage
16:16:53  [Pipeline] stage
16:16:53  [Pipeline] { (üìÅ Prepara√ß√£o do Ambiente)
16:16:53  [Pipeline] script
16:16:53  [Pipeline] {
16:16:53  [Pipeline] echo
16:16:53  üîß Preparando ambiente de trabalho...
16:16:53  [Pipeline] sh
16:16:54  + mkdir -p /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/temp
16:16:54  + mkdir -p /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/logs
16:16:54  + chmod +x /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/create_database.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/database_operations.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/deploy_application.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/generate_start_sql.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/get_db_host.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/verify_database.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/verify_deployment.sh
16:16:54  [Pipeline] sh
16:16:54  + [ -f /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/dados/ptf/dados.txt ]
16:16:54  + cp /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/dados/ptf/dados.txt /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/temp/
16:16:54  + echo ‚úÖ Dados do ambiente ptf copiados
16:16:54  ‚úÖ Dados do ambiente ptf copiados
16:16:54  [Pipeline] }
16:16:54  [Pipeline] // script
16:16:54  [Pipeline] }
16:16:54  [Pipeline] // stage
16:16:54  [Pipeline] stage
16:16:54  [Pipeline] { (üóÑÔ∏è Cria√ß√£o do Banco de Dados)
16:16:54  [Pipeline] script
16:16:54  [Pipeline] {
16:16:54  [Pipeline] echo
16:16:54  üóÑÔ∏è Iniciando cria√ß√£o do banco de dados...
16:16:54  [Pipeline] withCredentials
16:16:54  Masking supported pattern matches of $BASTION_HOST or $BASTION_USER or $DB_USER or $DB_PASSWORD or $SSH_KEY or $SSH_PASSPHRASE
16:16:54  [Pipeline] {
16:16:54  [Pipeline] sh
16:16:54  Warning: A secret was passed to "sh" using Groovy String interpolation, which is insecure.
16:16:54  		 Affected argument(s) used the following variable(s): [DB_USER, DB_PASSWORD]
16:16:54  		 See https://jenkins.io/redirect/groovy-string-interpolation for details.
16:16:55  + cat
16:16:55  + chmod +x /tmp/ssh-add-script-94672.sh
16:16:55  + ssh-agent -s
16:16:55  + eval SSH_AUTH_SOCK=/tmp/ssh-FF3GB0HlQwrA/agent.94676; export SSH_AUTH_SOCK; SSH_AGENT_PID=94677; export SSH_AGENT_PID; echo Agent pid 94677;
16:16:55  + SSH_AUTH_SOCK=/tmp/ssh-FF3GB0HlQwrA/agent.94676
16:16:55  + export SSH_AUTH_SOCK
16:16:55  + SSH_AGENT_PID=94677
16:16:55  + export SSH_AGENT_PID
16:16:55  + echo Agent pid 94677
16:16:55  Agent pid 94677
16:16:55  + DISPLAY=:0 SSH_ASKPASS=/tmp/ssh-add-script-94672.sh ssh-add ****
16:16:55  Identity added: **** (****)
16:16:55  + ssh -o StrictHostKeyChecking=no ****@**** mkdir -p /tmp/pipeline-17
16:16:55  + scp -o StrictHostKeyChecking=no -r /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/ ****@****:/tmp/pipeline-17/
16:16:55  + scp -o StrictHostKeyChecking=no -r /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/sql/ ****@****:/tmp/pipeline-17/
16:16:56  + scp -o StrictHostKeyChecking=no -r /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/dados/ ****@****:/tmp/pipeline-17/
16:16:56  + ssh -o StrictHostKeyChecking=no ****@****
16:16:56  Pseudo-terminal will not be allocated because stdin is not a terminal.
16:16:57  Linux routing-apl-no 6.1.0-23-cloud-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.99-1 (2024-07-15) x86_64
16:16:57  
16:16:57  The programs included with the Debian GNU/Linux system are free software;
16:16:57  the exact distribution terms for each program are described in the
16:16:57  individual files in /usr/share/doc/*/copyright.
16:16:57  
16:16:57  Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
16:16:57  permitted by applicable law.
16:16:57  === DEBUG - Vari√°veis do Pipeline ===
16:16:57  TIPO_AMBIENTE: ptf
16:16:57  SERVIDOR: gcp01
16:16:57  NOME_BANCO: ptf_base_teste
16:16:57  VERSAO_DESEJADA: 15.13.1.0-1
16:16:57  DB_HOST: 10.200.0.19
16:16:57  DB_PORT: 5432
16:16:57  DB_USER: ****
16:16:57  DB_PASSWORD: [MASKED]
16:16:57  WORKSPACE: /tmp/pipeline-17
16:16:57  
16:16:57  === DEBUG CREDENCIAIS ===
16:16:57  DB_USER vazio? N√ÉO - OK
16:16:57  DB_PASSWORD vazio? N√ÉO - OK
16:16:57  Tamanho DB_USER: 0
16:16:57  Tamanho DB_PASSWORD: 0
16:16:57  =========================
16:16:57  =================================
16:16:57  [0;34m[2025-12-15 19:16:57][0m üîç DEBUG CREDENCIAIS:
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - DB_USER: **** (tamanho: 10)
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - DB_PASSWORD: [TAMANHO: 12] [PRIMEIROS 3 CHARS: Fin***]
16:16:57  [0;34m[2025-12-15 19:16:57][0m üîß Senha codificada em base64 para evitar expans√£o de caracteres especiais
16:16:57  [0;34m[2025-12-15 19:16:57][0m üöÄ INICIANDO CRIA√á√ÉO DO BANCO DE DADOS
16:16:57  [0;34m[2025-12-15 19:16:57][0m üìã Configura√ß√£o:
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - Ambiente: ptf
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - Servidor: gcp01
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - Banco: ptf_base_teste
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - Host: 10.200.0.19:5432
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - Vers√£o: 15.13.1.0-1
16:16:57  [0;34m[2025-12-15 19:16:57][0m üìã Template obrigat√≥rio: ptf_banco_limpo_v15_12_0_3_43
16:16:57  [0;34m[2025-12-15 19:16:57][0m üîó Configura√ß√£o de conex√£o:
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - Servidor destino: 10.200.0.19:5432
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - Template source: 10.200.0.19:5432 (GCP01)
16:16:57  [0;34m[2025-12-15 19:16:57][0m üîß Verificando ambiente de execu√ß√£o...
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - Usu√°rio: ****
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - Sistema: Linux routing-apl-no 6.1.0-23-cloud-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.99-1 (2024-07-15) x86_64 GNU/Linux
16:16:57  [0;34m[2025-12-15 19:16:57][0m    - PostgreSQL client: /usr/bin/psql
16:16:57  [0;32m[2025-12-15 19:16:57] ‚úÖ PostgreSQL client encontrado: /usr/bin/psql[0m
16:16:57  [0;34m[2025-12-15 19:16:57][0m üîç Testando conex√£o com o servidor de banco...
16:16:57  [0;34m[2025-12-15 19:16:57][0m üîß Comando: psql -h 10.200.0.19 -p 5432 -U **** -d ptf_banco_limpo_v15_12_0_3_43 -c "SELECT 1;"
16:16:57  [0;31m[2025-12-15 19:16:57] ‚ùå Falha ao conectar com o servidor PostgreSQL em 10.200.0.19:5432[0m
16:16:57  [0;31m[2025-12-15 19:16:57] ‚ùå Erro espec√≠fico: psql: error: connection to server at "10.200.0.19", port 5432 failed: FATAL:  password authentication failed for user "****"
16:16:57  connection to server at "10.200.0.19", port 5432 failed: FATAL:  password authentication failed for user "****"[0m
16:16:57  [0;31m[2025-12-15 19:16:57] ‚ùå [0m
16:16:57  [0;31m[2025-12-15 19:16:57] ‚ùå Verifique se:[0m
16:16:57  [0;31m[2025-12-15 19:16:57] ‚ùå   1. O servidor PostgreSQL est√° rodando[0m
16:16:57  [0;31m[2025-12-15 19:16:57] ‚ùå   2. O bastion host tem acesso √† rede privada[0m
16:16:57  [0;31m[2025-12-15 19:16:57] ‚ùå   3. As credenciais est√£o corretas (usu√°rio: ****)[0m
16:16:57  [0;31m[2025-12-15 19:16:57] ‚ùå   4. A porta 5432 est√° aberta[0m
16:16:57  [0;31m[2025-12-15 19:16:57] ‚ùå   5. O template 'ptf_banco_limpo_v15_12_0_3_43' existe[0m
16:16:57  ‚ùå ERRO: Falha na cria√ß√£o do banco de dados!
16:16:57  [Pipeline] error
16:16:57  [Pipeline] }
16:16:57  [Pipeline] // withCredentials
16:16:57  [Pipeline] }
16:16:57  [Pipeline] // script
16:16:57  [Pipeline] }
16:16:57  [Pipeline] // stage
16:16:57  [Pipeline] stage
16:16:57  [Pipeline] { (üöÄ Deploy da Aplica√ß√£o)
16:16:57  Stage "üöÄ Deploy da Aplica√ß√£o" skipped due to earlier failure(s)
16:16:57  [Pipeline] getContext
16:16:57  [Pipeline] }
16:16:57  [Pipeline] // stage
16:16:57  [Pipeline] stage
16:16:57  [Pipeline] { (‚úÖ Verifica√ß√£o Final)
16:16:57  Stage "‚úÖ Verifica√ß√£o Final" skipped due to earlier failure(s)
16:16:57  [Pipeline] getContext
16:16:57  [Pipeline] }
16:16:57  [Pipeline] // stage
16:16:57  [Pipeline] stage
16:16:57  [Pipeline] { (Declarative: Post Actions)
16:16:57  [Pipeline] script
16:16:58  [Pipeline] {
16:16:58  [Pipeline] echo
16:16:58  üßπ Executando limpeza...
16:16:58  [Pipeline] fileExists
16:16:58  [Pipeline] archiveArtifacts
16:16:58  Archiving artifacts
16:16:58  [Pipeline] sh
16:16:58  + rm -rf /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/temp
16:16:58  + find /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE -name *.tmp -delete
16:16:58  [Pipeline] withCredentials
16:16:58  Masking supported pattern matches of $BASTION_HOST or $BASTION_USER or $SSH_KEY or $SSH_PASSPHRASE
16:16:58  [Pipeline] {
16:16:58  [Pipeline] sh
16:16:58  + cat
16:16:58  + chmod +x /tmp/ssh-add-script-94720.sh
16:16:58  + ssh-agent -s
16:16:58  + eval SSH_AUTH_SOCK=/tmp/ssh-zZdOBpAOQI9a/agent.94725; export SSH_AUTH_SOCK; SSH_AGENT_PID=94726; export SSH_AGENT_PID; echo Agent pid 94726;
16:16:58  + SSH_AUTH_SOCK=/tmp/ssh-zZdOBpAOQI9a/agent.94725
16:16:58  + export SSH_AUTH_SOCK
16:16:58  + SSH_AGENT_PID=94726
16:16:58  + export SSH_AGENT_PID
16:16:58  + echo Agent pid 94726
16:16:58  Agent pid 94726
16:16:58  + DISPLAY=:0 SSH_ASKPASS=/tmp/ssh-add-script-94720.sh ssh-add ****
16:16:58  Identity added: **** (****)
16:16:58  + ssh -o StrictHostKeyChecking=no ****@**** rm -rf /tmp/pipeline-17
16:16:58  + ssh-agent -k
16:16:58  unset SSH_AUTH_SOCK;
16:16:58  unset SSH_AGENT_PID;
16:16:58  echo Agent pid 94726 killed;
16:16:58  + rm -f /tmp/ssh-add-script-94720.sh
16:16:58  [Pipeline] }
16:16:59  [Pipeline] // withCredentials
16:16:59  [Pipeline] }
16:16:59  [Pipeline] // script
16:16:59  [Pipeline] echo
16:16:59  
16:16:59  ‚ùå ===== PIPELINE FALHOU! =====
16:16:59  üìã Verifique os logs para mais detalhes.
16:16:59  Par√¢metros utilizados:
16:16:59     - Ambiente: ptf
16:16:59     - Servidor: gcp01
16:16:59     - Banco: ptf_base_teste
16:16:59  ==============================
16:16:59              
16:16:59  [Pipeline] }
16:16:59  [Pipeline] // stage
16:16:59  [Pipeline] }
16:16:59  [Pipeline] // withEnv
16:16:59  [Pipeline] }
16:16:59  [Pipeline] // withEnv
16:16:59  [Pipeline] }
16:16:59  [Pipeline] // node
16:16:59  [Pipeline] End of Pipeline
16:16:59  ERROR: ‚ùå Falha na cria√ß√£o do banco de dados! Exit code: 1
16:16:59  Finished: FAILURE