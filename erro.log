14:51:02  Started by user infraestrutura
14:51:03  Obtained Jenkinsfile from git https://github.com/luangitdev/pipeline-criar-ambiente.git
14:51:03  [Pipeline] Start of Pipeline
14:51:04  [Pipeline] node
14:51:04  Running on Jenkins in /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE
14:51:04  [Pipeline] {
14:51:04  [Pipeline] stage
14:51:04  [Pipeline] { (Declarative: Checkout SCM)
14:51:04  [Pipeline] checkout
14:51:04  Selected Git installation does not exist. Using Default
14:51:04  The recommended git tool is: NONE
14:51:04  using credential github-credentials-luan
14:51:04   > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/.git # timeout=10
14:51:04  Fetching changes from the remote Git repository
14:51:04   > git config remote.origin.url https://github.com/luangitdev/pipeline-criar-ambiente.git # timeout=10
14:51:04  Fetching upstream changes from https://github.com/luangitdev/pipeline-criar-ambiente.git
14:51:04   > git --version # timeout=10
14:51:04   > git --version # 'git version 2.39.5'
14:51:04  using GIT_ASKPASS to set credentials Credenciais da conta github (Luan)
14:51:04   > git fetch --tags --force --progress -- https://github.com/luangitdev/pipeline-criar-ambiente.git +refs/heads/*:refs/remotes/origin/* # timeout=10
14:51:05   > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
14:51:05  Checking out Revision f8b6b7514c3b84ec9f139bc5fc6d6f134119e8e1 (refs/remotes/origin/main)
14:51:05   > git config core.sparsecheckout # timeout=10
14:51:05   > git checkout -f f8b6b7514c3b84ec9f139bc5fc6d6f134119e8e1 # timeout=10
14:51:05  Commit message: "feat: Atualiza IPs dos servidores"
14:51:05   > git rev-list --no-walk f539baf714b3336d051bb3d688a95c6fad205ce6 # timeout=10
14:51:05  [Pipeline] }
14:51:05  [Pipeline] // stage
14:51:05  [Pipeline] withEnv
14:51:05  [Pipeline] {
14:51:05  [Pipeline] withEnv
14:51:05  [Pipeline] {
14:51:05  [Pipeline] stage
14:51:05  [Pipeline] { (üîç Valida√ß√£o de Par√¢metros)
14:51:05  [Pipeline] script
14:51:05  [Pipeline] {
14:51:05  [Pipeline] echo
14:51:05  üöÄ ===== PIPELINE CRIAR AMBIENTE =====
14:51:05  [Pipeline] echo
14:51:05  üìã Par√¢metros recebidos:
14:51:05  [Pipeline] echo
14:51:05     - Tipo Ambiente: ptf
14:51:05  [Pipeline] echo
14:51:05     - Servidor: gcp01
14:51:05  [Pipeline] echo
14:51:05     - Nome Banco: ptf_base_teste
14:51:05  [Pipeline] echo
14:51:05     - Vers√£o: 15.13.1.0-1
14:51:05  [Pipeline] echo
14:51:05     - Criar Banco: true
14:51:05  [Pipeline] echo
14:51:05     - Deploy App: false
14:51:05  [Pipeline] echo
14:51:05  =======================================
14:51:05  [Pipeline] sh
14:51:06  + /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/get_db_host.sh gcp01
14:51:06  [Pipeline] echo
14:51:06  ‚úÖ Valida√ß√£o conclu√≠da. DB Host: 10.200.0.19
14:51:06  [Pipeline] }
14:51:06  [Pipeline] // script
14:51:06  [Pipeline] }
14:51:06  [Pipeline] // stage
14:51:06  [Pipeline] stage
14:51:06  [Pipeline] { (üìÅ Prepara√ß√£o do Ambiente)
14:51:06  [Pipeline] script
14:51:06  [Pipeline] {
14:51:06  [Pipeline] echo
14:51:06  üîß Preparando ambiente de trabalho...
14:51:06  [Pipeline] sh
14:51:06  + mkdir -p /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/temp
14:51:06  + mkdir -p /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/logs
14:51:06  + chmod +x /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/create_database.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/database_operations.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/deploy_application.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/generate_start_sql.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/get_db_host.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/verify_database.sh /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/verify_deployment.sh
14:51:06  [Pipeline] sh
14:51:07  + [ -f /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/dados/ptf/dados.txt ]
14:51:07  + cp /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/dados/ptf/dados.txt /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/temp/
14:51:07  + echo ‚úÖ Dados do ambiente ptf copiados
14:51:07  ‚úÖ Dados do ambiente ptf copiados
14:51:07  [Pipeline] }
14:51:07  [Pipeline] // script
14:51:07  [Pipeline] }
14:51:07  [Pipeline] // stage
14:51:07  [Pipeline] stage
14:51:07  [Pipeline] { (üóÑÔ∏è Cria√ß√£o do Banco de Dados)
14:51:07  [Pipeline] script
14:51:07  [Pipeline] {
14:51:07  [Pipeline] echo
14:51:07  üóÑÔ∏è Iniciando cria√ß√£o do banco de dados...
14:51:07  [Pipeline] withCredentials
14:51:07  Masking supported pattern matches of $BASTION_HOST or $BASTION_USER or $DB_USER or $DB_PASSWORD or $SSH_KEY or $SSH_PASSPHRASE
14:51:07  [Pipeline] {
14:51:07  [Pipeline] sh
14:51:07  Warning: A secret was passed to "sh" using Groovy String interpolation, which is insecure.
14:51:07  		 Affected argument(s) used the following variable(s): [DB_USER, DB_PASSWORD]
14:51:07  		 See https://jenkins.io/redirect/groovy-string-interpolation for details.
14:51:07  + cat
14:51:07  + chmod +x /tmp/ssh-add-script-92111.sh
14:51:07  + ssh-agent -s
14:51:07  + eval SSH_AUTH_SOCK=/tmp/ssh-37Pb1bY8Abb3/agent.92115; export SSH_AUTH_SOCK; SSH_AGENT_PID=92116; export SSH_AGENT_PID; echo Agent pid 92116;
14:51:07  + SSH_AUTH_SOCK=/tmp/ssh-37Pb1bY8Abb3/agent.92115
14:51:07  + export SSH_AUTH_SOCK
14:51:07  + SSH_AGENT_PID=92116
14:51:07  + export SSH_AGENT_PID
14:51:07  + echo Agent pid 92116
14:51:07  Agent pid 92116
14:51:07  + DISPLAY=:0 SSH_ASKPASS=/tmp/ssh-add-script-92111.sh ssh-add ****
14:51:07  Identity added: **** (****)
14:51:07  + ssh -o StrictHostKeyChecking=no ****@**** mkdir -p /tmp/pipeline-7
14:51:08  + scp -o StrictHostKeyChecking=no -r /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/scripts/ ****@****:/tmp/pipeline-7/
14:51:08  + scp -o StrictHostKeyChecking=no -r /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/sql/ ****@****:/tmp/pipeline-7/
14:51:09  + scp -o StrictHostKeyChecking=no -r /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/dados/ ****@****:/tmp/pipeline-7/
14:51:09  + ssh -o StrictHostKeyChecking=no ****@****
14:51:09  Pseudo-terminal will not be allocated because stdin is not a terminal.
14:51:10  Linux routing-apl-no 6.1.0-23-cloud-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.99-1 (2024-07-15) x86_64
14:51:10  
14:51:10  The programs included with the Debian GNU/Linux system are free software;
14:51:10  the exact distribution terms for each program are described in the
14:51:10  individual files in /usr/share/doc/*/copyright.
14:51:10  
14:51:10  Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
14:51:10  permitted by applicable law.
14:51:10  [0;34m[2025-12-15 17:51:10][0m üöÄ INICIANDO CRIA√á√ÉO DO BANCO DE DADOS
14:51:10  [0;34m[2025-12-15 17:51:10][0m üìã Configura√ß√£o:
14:51:10  [0;34m[2025-12-15 17:51:10][0m    - Ambiente: ptf
14:51:10  [0;34m[2025-12-15 17:51:10][0m    - Servidor: gcp01
14:51:10  [0;34m[2025-12-15 17:51:10][0m    - Banco: ptf_base_teste
14:51:10  [0;34m[2025-12-15 17:51:10][0m    - Host: 10.200.0.19:5432
14:51:10  [0;34m[2025-12-15 17:51:10][0m    - Vers√£o: 15.13.1.0-1
14:51:10  [0;34m[2025-12-15 17:51:10][0m üìã Template: ptf_banco_limpo_v15_12_0_3_43
14:51:10  [0;34m[2025-12-15 17:51:10][0m üîç Testando conex√£o com o servidor de banco...
14:51:10  [0;31m[2025-12-15 17:51:10] ‚ùå Falha ao conectar com o servidor PostgreSQL em 10.200.0.19:5432[0m
14:51:10  [0;31m[2025-12-15 17:51:10] ‚ùå Verifique se o servidor est√° rodando e acess√≠vel[0m
14:51:10  ‚ùå ERRO: Falha na cria√ß√£o do banco de dados!
14:51:10  [Pipeline] error
14:51:10  [Pipeline] }
14:51:10  [Pipeline] // withCredentials
14:51:10  [Pipeline] }
14:51:10  [Pipeline] // script
14:51:10  [Pipeline] }
14:51:10  [Pipeline] // stage
14:51:10  [Pipeline] stage
14:51:10  [Pipeline] { (üöÄ Deploy da Aplica√ß√£o)
14:51:10  Stage "üöÄ Deploy da Aplica√ß√£o" skipped due to earlier failure(s)
14:51:10  [Pipeline] getContext
14:51:10  [Pipeline] }
14:51:10  [Pipeline] // stage
14:51:10  [Pipeline] stage
14:51:10  [Pipeline] { (‚úÖ Verifica√ß√£o Final)
14:51:10  Stage "‚úÖ Verifica√ß√£o Final" skipped due to earlier failure(s)
14:51:10  [Pipeline] getContext
14:51:10  [Pipeline] }
14:51:10  [Pipeline] // stage
14:51:10  [Pipeline] stage
14:51:10  [Pipeline] { (Declarative: Post Actions)
14:51:10  [Pipeline] script
14:51:10  [Pipeline] {
14:51:10  [Pipeline] echo
14:51:10  üßπ Executando limpeza...
14:51:10  [Pipeline] fileExists
14:51:11  [Pipeline] archiveArtifacts
14:51:11  Archiving artifacts
14:51:11  [Pipeline] sh
14:51:11  + rm -rf /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE/temp
14:51:11  + find /var/jenkins_home/workspace/PTF-CRIAR-AMBIENTE -name *.tmp -delete
14:51:11  [Pipeline] withCredentials
14:51:11  Masking supported pattern matches of $BASTION_HOST or $BASTION_USER or $SSH_KEY or $SSH_PASSPHRASE
14:51:11  [Pipeline] {
14:51:11  [Pipeline] sh
14:51:11  + cat
14:51:11  + chmod +x /tmp/ssh-add-script-92155.sh
14:51:11  + ssh-agent -s
14:51:11  + eval SSH_AUTH_SOCK=/tmp/ssh-88qGnfLamXpv/agent.92160; export SSH_AUTH_SOCK; SSH_AGENT_PID=92161; export SSH_AGENT_PID; echo Agent pid 92161;
14:51:11  + SSH_AUTH_SOCK=/tmp/ssh-88qGnfLamXpv/agent.92160
14:51:11  + export SSH_AUTH_SOCK
14:51:11  + SSH_AGENT_PID=92161
14:51:11  + export SSH_AGENT_PID
14:51:11  + echo Agent pid 92161
14:51:11  Agent pid 92161
14:51:11  + DISPLAY=:0 SSH_ASKPASS=/tmp/ssh-add-script-92155.sh ssh-add ****
14:51:11  Identity added: **** (****)
14:51:11  + ssh -o StrictHostKeyChecking=no ****@**** rm -rf /tmp/pipeline-7
14:51:11  + ssh-agent -k
14:51:11  unset SSH_AUTH_SOCK;
14:51:11  unset SSH_AGENT_PID;
14:51:11  echo Agent pid 92161 killed;
14:51:11  + rm -f /tmp/ssh-add-script-92155.sh
14:51:11  [Pipeline] }
14:51:11  [Pipeline] // withCredentials
14:51:12  [Pipeline] }
14:51:12  [Pipeline] // script
14:51:12  [Pipeline] echo
14:51:12  
14:51:12  ‚ùå ===== PIPELINE FALHOU! =====
14:51:12  üìã Verifique os logs para mais detalhes.
14:51:12  Par√¢metros utilizados:
14:51:12     - Ambiente: ptf
14:51:12     - Servidor: gcp01
14:51:12     - Banco: ptf_base_teste
14:51:12  ==============================
14:51:12              
14:51:12  [Pipeline] }
14:51:12  [Pipeline] // stage
14:51:12  [Pipeline] }
14:51:12  [Pipeline] // withEnv
14:51:12  [Pipeline] }
14:51:12  [Pipeline] // withEnv
14:51:12  [Pipeline] }
14:51:12  [Pipeline] // node
14:51:12  [Pipeline] End of Pipeline
14:51:12  ERROR: ‚ùå Falha na cria√ß√£o do banco de dados! Exit code: 1
14:51:12  Finished: FAILURE